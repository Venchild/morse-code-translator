// Language translations - ëª¨ë“  ì–¸ì–´ ì™„ì„±
const translations = {
    en: {
        title: "MOST - Morse Code Translator",
        subtitle: "Real-time translation between text and Morse code",
        inputLabel: "Enter text to translate",
        outputLabel: "Morse Code Output",
        modeTextToMorse: "Text â†’ Morse",
        modeMorseToText: "Morse â†’ Text",
        playText: "Play",
        copyText: "Copy",
        clearText: "Clear",
        shareText: "Share",
        shareTitle: "Share this translation",
        copyUrlText: "Copy URL",
        downloadTitle: "Want more features?",
        downloadDescription: "Download the full app to access Timeline community features, save your translations, and connect with other users!",
        downloadText: "Download on Google Play",
        speedLabel: "Speed:",
        detectedLang: "Detected language: ",
        placeholder: "Type your message here...",
        morsePlaceholder: "Enter Morse code here (use . for dot, - for dash)...",
        referenceText: "Code Reference",
        modalTitle: "Morse Code Reference"
    },
    ko: {
        title: "MOST - ëª¨ìŠ¤ ë¶€í˜¸ ë²ˆì—­ê¸°",
        subtitle: "í…ìŠ¤íŠ¸ì™€ ëª¨ìŠ¤ ë¶€í˜¸ ê°„ ì‹¤ì‹œê°„ ë²ˆì—­",
        inputLabel: "ë²ˆì—­í•  í…ìŠ¤íŠ¸ ìž…ë ¥",
        outputLabel: "ëª¨ìŠ¤ ë¶€í˜¸ ì¶œë ¥",
        modeTextToMorse: "í…ìŠ¤íŠ¸ â†’ ëª¨ìŠ¤",
        modeMorseToText: "ëª¨ìŠ¤ â†’ í…ìŠ¤íŠ¸",
        playText: "ìž¬ìƒ",
        copyText: "ë³µì‚¬",
        clearText: "ì§€ìš°ê¸°",
        shareText: "ê³µìœ ",
        shareTitle: "ì´ ë²ˆì—­ ê³µìœ í•˜ê¸°",
        copyUrlText: "URL ë³µì‚¬",
        downloadTitle: "ë” ë§Žì€ ê¸°ëŠ¥ì´ í•„ìš”í•˜ì„¸ìš”?",
        downloadDescription: "ì „ì²´ ì•±ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ íƒ€ìž„ë¼ì¸ ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥, ë²ˆì—­ ì €ìž¥, ë‹¤ë¥¸ ì‚¬ìš©ìžì™€ì˜ ì—°ê²°ì„ ì´ìš©í•˜ì„¸ìš”!",
        downloadText: "Google Playì—ì„œ ë‹¤ìš´ë¡œë“œ",
        speedLabel: "ì†ë„:",
        detectedLang: "ê°ì§€ëœ ì–¸ì–´: ",
        placeholder: "ì—¬ê¸°ì— ë©”ì‹œì§€ë¥¼ ìž…ë ¥í•˜ì„¸ìš”...",
        morsePlaceholder: "ëª¨ìŠ¤ ë¶€í˜¸ë¥¼ ìž…ë ¥í•˜ì„¸ìš” (ì ì€ ., ì„ ì€ -)...",
        referenceText: "ì½”ë“œ ì°¸ì¡°",
        modalTitle: "ëª¨ìŠ¤ ë¶€í˜¸ ì°¸ì¡°í‘œ"
    },
    ja: {
        title: "MOST - ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ç¿»è¨³æ©Ÿ",
        subtitle: "ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¿»è¨³",
        inputLabel: "ç¿»è¨³ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›",
        outputLabel: "ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·å‡ºåŠ›",
        modeTextToMorse: "ãƒ†ã‚­ã‚¹ãƒˆ â†’ ãƒ¢ãƒ¼ãƒ«ã‚¹",
        modeMorseToText: "ãƒ¢ãƒ¼ãƒ«ã‚¹ â†’ ãƒ†ã‚­ã‚¹ãƒˆ",
        playText: "å†ç”Ÿ",
        copyText: "ã‚³ãƒ”ãƒ¼",
        clearText: "ã‚¯ãƒªã‚¢",
        shareText: "å…±æœ‰",
        shareTitle: "ã“ã®ç¿»è¨³ã‚’å…±æœ‰",
        copyUrlText: "URLã‚’ã‚³ãƒ”ãƒ¼",
        downloadTitle: "ã‚‚ã£ã¨æ©Ÿèƒ½ãŒæ¬²ã—ã„ã§ã™ã‹ï¼Ÿ",
        downloadDescription: "å®Œå…¨ç‰ˆã‚¢ãƒ—ãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ©Ÿèƒ½ã€ç¿»è¨³ã®ä¿å­˜ã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®æŽ¥ç¶šã‚’ãŠæ¥½ã—ã¿ãã ã•ã„ï¼",
        downloadText: "Google Playã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰",
        speedLabel: "é€Ÿåº¦:",
        detectedLang: "æ¤œå‡ºã•ã‚ŒãŸè¨€èªž: ",
        placeholder: "ã“ã“ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...",
        morsePlaceholder: "ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ (ãƒ‰ãƒƒãƒˆã¯ .ã€ãƒ€ãƒƒã‚·ãƒ¥ã¯ -)...",
        referenceText: "ç¬¦å·è¡¨",
        modalTitle: "ãƒ¢ãƒ¼ãƒ«ã‚¹ç¬¦å·è¡¨"
    },
    zh: {
        title: "MOST - æ‘©å°”æ–¯ç”µç ç¿»è¯‘å™¨",
        subtitle: "æ–‡æœ¬ä¸Žæ‘©å°”æ–¯ç”µç çš„å®žæ—¶ç¿»è¯‘",
        inputLabel: "è¾“å…¥è¦ç¿»è¯‘çš„æ–‡æœ¬",
        outputLabel: "æ‘©å°”æ–¯ç”µç è¾“å‡º",
        modeTextToMorse: "æ–‡æœ¬ â†’ æ‘©å°”æ–¯",
        modeMorseToText: "æ‘©å°”æ–¯ â†’ æ–‡æœ¬",
        playText: "æ’­æ”¾",
        copyText: "å¤åˆ¶",
        clearText: "æ¸…é™¤",
        shareText: "åˆ†äº«",
        shareTitle: "åˆ†äº«æ­¤ç¿»è¯‘",
        copyUrlText: "å¤åˆ¶é“¾æŽ¥",
        downloadTitle: "éœ€è¦æ›´å¤šåŠŸèƒ½ï¼Ÿ",
        downloadDescription: "ä¸‹è½½å®Œæ•´åº”ç”¨ä»¥è®¿é—®æ—¶é—´çº¿ç¤¾åŒºåŠŸèƒ½ã€ä¿å­˜ç¿»è¯‘å¹¶ä¸Žå…¶ä»–ç”¨æˆ·è¿žæŽ¥ï¼",
        downloadText: "åœ¨Google Playä¸‹è½½",
        speedLabel: "é€Ÿåº¦ï¼š",
        detectedLang: "æ£€æµ‹åˆ°çš„è¯­è¨€ï¼š",
        placeholder: "åœ¨æ­¤è¾“å…¥æ‚¨çš„æ¶ˆæ¯...",
        morsePlaceholder: "åœ¨æ­¤è¾“å…¥æ‘©å°”æ–¯ç”µç ï¼ˆç”¨.è¡¨ç¤ºç‚¹ï¼Œ-è¡¨ç¤ºåˆ’ï¼‰...",
        referenceText: "ç”µç è¡¨",
        modalTitle: "æ‘©å°”æ–¯ç”µç è¡¨"
    },
    es: {
        title: "MOST - Traductor de CÃ³digo Morse",
        subtitle: "TraducciÃ³n en tiempo real entre texto y cÃ³digo Morse",
        inputLabel: "Ingrese el texto a traducir",
        outputLabel: "Salida de CÃ³digo Morse",
        modeTextToMorse: "Texto â†’ Morse",
        modeMorseToText: "Morse â†’ Texto",
        playText: "Reproducir",
        copyText: "Copiar",
        clearText: "Limpiar",
        shareText: "Compartir",
        shareTitle: "Compartir esta traducciÃ³n",
        copyUrlText: "Copiar URL",
        downloadTitle: "Â¿Quieres mÃ¡s funciones?",
        downloadDescription: "Â¡Descarga la aplicaciÃ³n completa para acceder a las funciones de la comunidad Timeline, guardar tus traducciones y conectar con otros usuarios!",
        downloadText: "Descargar en Google Play",
        speedLabel: "Velocidad:",
        detectedLang: "Idioma detectado: ",
        placeholder: "Escriba su mensaje aquÃ­...",
        morsePlaceholder: "Ingrese cÃ³digo Morse aquÃ­ (use . para punto, - para raya)...",
        referenceText: "Tabla de CÃ³digos",
        modalTitle: "Tabla de CÃ³digo Morse"
    },
    fr: {
        title: "MOST - Traducteur de Code Morse",
        subtitle: "Traduction en temps rÃ©el entre texte et code Morse",
        inputLabel: "Saisissez le texte Ã  traduire",
        outputLabel: "Sortie du Code Morse",
        modeTextToMorse: "Texte â†’ Morse",
        modeMorseToText: "Morse â†’ Texte",
        playText: "Jouer",
        copyText: "Copier",
        clearText: "Effacer",
        shareText: "Partager",
        shareTitle: "Partager cette traduction",
        copyUrlText: "Copier l'URL",
        downloadTitle: "Vous voulez plus de fonctionnalitÃ©s?",
        downloadDescription: "TÃ©lÃ©chargez l'application complÃ¨te pour accÃ©der aux fonctionnalitÃ©s de la communautÃ© Timeline, sauvegarder vos traductions et vous connecter avec d'autres utilisateurs!",
        downloadText: "TÃ©lÃ©charger sur Google Play",
        speedLabel: "Vitesse:",
        detectedLang: "Langue dÃ©tectÃ©e: ",
        placeholder: "Tapez votre message ici...",
        morsePlaceholder: "Entrez le code Morse ici (utilisez . pour point, - pour tiret)...",
        referenceText: "Table des Codes",
        modalTitle: "Table du Code Morse"
    },
    de: {
        title: "MOST - Morsecode-Ãœbersetzer",
        subtitle: "Echtzeit-Ãœbersetzung zwischen Text und Morsecode",
        inputLabel: "Text zum Ãœbersetzen eingeben",
        outputLabel: "Morsecode-Ausgabe",
        modeTextToMorse: "Text â†’ Morse",
        modeMorseToText: "Morse â†’ Text",
        playText: "Abspielen",
        copyText: "Kopieren",
        clearText: "LÃ¶schen",
        shareText: "Teilen",
        shareTitle: "Diese Ãœbersetzung teilen",
        copyUrlText: "URL kopieren",
        downloadTitle: "MÃ¶chten Sie mehr Funktionen?",
        downloadDescription: "Laden Sie die vollstÃ¤ndige App herunter, um auf Timeline-Community-Funktionen zuzugreifen, Ihre Ãœbersetzungen zu speichern und sich mit anderen Benutzern zu verbinden!",
        downloadText: "Bei Google Play herunterladen",
        speedLabel: "Geschwindigkeit:",
        detectedLang: "Erkannte Sprache: ",
        placeholder: "Geben Sie hier Ihre Nachricht ein...",
        morsePlaceholder: "Geben Sie hier Morsecode ein (verwenden Sie . fÃ¼r Punkt, - fÃ¼r Strich)...",
        referenceText: "Code-Tabelle",
        modalTitle: "Morsecode-Tabelle"
    },
    ru: {
        title: "MOST - ÐŸÐµÑ€ÐµÐ²Ð¾Ð´Ñ‡Ð¸Ðº Ð°Ð·Ð±ÑƒÐºÐ¸ ÐœÐ¾Ñ€Ð·Ðµ",
        subtitle: "ÐŸÐµÑ€ÐµÐ²Ð¾Ð´ Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ Ñ‚ÐµÐºÑÑ‚Ð¾Ð¼ Ð¸ Ð°Ð·Ð±ÑƒÐºÐ¾Ð¹ ÐœÐ¾Ñ€Ð·Ðµ",
        inputLabel: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð°",
        outputLabel: "Ð’Ñ‹Ð²Ð¾Ð´ Ð°Ð·Ð±ÑƒÐºÐ¸ ÐœÐ¾Ñ€Ð·Ðµ",
        modeTextToMorse: "Ð¢ÐµÐºÑÑ‚ â†’ ÐœÐ¾Ñ€Ð·Ðµ",
        modeMorseToText: "ÐœÐ¾Ñ€Ð·Ðµ â†’ Ð¢ÐµÐºÑÑ‚",
        playText: "Ð’Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÑÑ‚Ð¸",
        copyText: "ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ",
        clearText: "ÐžÑ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ",
        shareText: "ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ",
        shareTitle: "ÐŸÐ¾Ð´ÐµÐ»Ð¸Ñ‚ÑŒÑÑ ÑÑ‚Ð¸Ð¼ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¾Ð¼",
        copyUrlText: "ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ URL",
        downloadTitle: "Ð¥Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹?",
        downloadDescription: "Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ð¿Ð¾Ð»Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼ ÑÐ¾Ð¾Ð±Ñ‰ÐµÑÑ‚Ð²Ð° Timeline, ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´Ð¾Ð² Ð¸ ÑÐ²ÑÐ·Ð¸ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸!",
        downloadText: "Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð² Google Play",
        speedLabel: "Ð¡ÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ:",
        detectedLang: "ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ·Ñ‹Ðº: ",
        placeholder: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð²Ð°ÑˆÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð·Ð´ÐµÑÑŒ...",
        morsePlaceholder: "Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð°Ð·Ð±ÑƒÐºÑƒ ÐœÐ¾Ñ€Ð·Ðµ Ð·Ð´ÐµÑÑŒ (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ . Ð´Ð»Ñ Ñ‚Ð¾Ñ‡ÐºÐ¸, - Ð´Ð»Ñ Ñ‚Ð¸Ñ€Ðµ)...",
        referenceText: "Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÐšÐ¾Ð´Ð¾Ð²",
        modalTitle: "Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÐÐ·Ð±ÑƒÐºÐ¸ ÐœÐ¾Ñ€Ð·Ðµ"
    },
    ar: {
        title: "MOST - Ù…ØªØ±Ø¬Ù… Ø´ÙØ±Ø© Ù…ÙˆØ±Ø³",
        subtitle: "ØªØ±Ø¬Ù…Ø© ÙÙˆØ±ÙŠØ© Ø¨ÙŠÙ† Ø§Ù„Ù†Øµ ÙˆØ´ÙØ±Ø© Ù…ÙˆØ±Ø³",
        inputLabel: "Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ù„Ù„ØªØ±Ø¬Ù…Ø©",
        outputLabel: "Ù…Ø®Ø±Ø¬Ø§Øª Ø´ÙØ±Ø© Ù…ÙˆØ±Ø³",
        modeTextToMorse: "Ù†Øµ â† Ù…ÙˆØ±Ø³",
        modeMorseToText: "Ù…ÙˆØ±Ø³ â† Ù†Øµ",
        playText: "ØªØ´ØºÙŠÙ„",
        copyText: "Ù†Ø³Ø®",
        clearText: "Ù…Ø³Ø­",
        shareText: "Ù…Ø´Ø§Ø±ÙƒØ©",
        shareTitle: "Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ø°Ù‡ Ø§Ù„ØªØ±Ø¬Ù…Ø©",
        copyUrlText: "Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·",
        downloadTitle: "ØªØ±ÙŠØ¯ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…ÙŠØ²Ø§ØªØŸ",
        downloadDescription: "Ù‚Ù… Ø¨ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙŠØ²Ø§Øª Ù…Ø¬ØªÙ…Ø¹ Ø§Ù„Ø®Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ­ÙØ¸ ØªØ±Ø¬Ù…Ø§ØªÙƒ ÙˆØ§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†!",
        downloadText: "ØªÙ†Ø²ÙŠÙ„ Ù…Ù† Google Play",
        speedLabel: "Ø§Ù„Ø³Ø±Ø¹Ø©:",
        detectedLang: "Ø§Ù„Ù„ØºØ© Ø§Ù„Ù…ÙƒØªØ´ÙØ©: ",
        placeholder: "Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...",
        morsePlaceholder: "Ø£Ø¯Ø®Ù„ Ø´ÙØ±Ø© Ù…ÙˆØ±Ø³ Ù‡Ù†Ø§ (Ø§Ø³ØªØ®Ø¯Ù… . Ù„Ù„Ù†Ù‚Ø·Ø©ØŒ - Ù„Ù„Ø´Ø±Ø·Ø©)...",
        referenceText: "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´ÙØ±Ø§Øª",
        modalTitle: "Ø¬Ø¯ÙˆÙ„ Ø´ÙØ±Ø© Ù…ÙˆØ±Ø³"
    }
};

// Morse code mappings organized by language/script
const morseCodeTables = {
    latin: {
        title: "Latin Alphabet & Numbers",
        codes: {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
            'Y': '-.--', 'Z': '--..', 
            '0': '-----', '1': '.----', '2': '..---', '3': '...--', '4': '....-',
            '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.'
        }
    },
    korean: {
        title: "Korean (í•œê¸€)",
        codes: {
            // Basic consonants
            'ã„±': '.-.', 'ã„´': '..-.', 'ã„·': '-..', 'ã„¹': '...-', 'ã…': '--',
            'ã…‚': '.--', 'ã……': '--.', 'ã…‡': '-.-', 'ã…ˆ': '.---.', 'ã…Š': '-.-.', 
            'ã…‹': '-..-', 'ã…Œ': '--..', 'ã…': '---', 'ã…Ž': '.---',
            // Basic vowels
            'ã…': '.', 'ã…‘': '..', 'ã…“': '-', 'ã…•': '...', 'ã…—': '.--', 
            'ã…›': '-.', 'ã…œ': '....', 'ã… ': '.-.', 'ã…¡': '-..-', 'ã…£': '..-',
            // Complex consonants
            'ã„²': '.-.-.', 'ã„¸': '-..-.', 'ã…ƒ': '.--.',
            'ã…†': '--.-', 'ã…‰': '.---.',
            // Complex vowels
            'ã…': '.--', 'ã…’': '..--', 'ã…”': '-.--', 'ã…–': '...--',
            'ã…˜': '.---', 'ã…™': '.----', 'ã…š': '.--.-',
            'ã…': '....--', 'ã…ž': '....---', 'ã…Ÿ': '....-',
            'ã…¢': '..-.-'
        }
    },
    japanese: {
        title: "Japanese (ã‚«ã‚¿ã‚«ãƒŠ)",
        codes: {
            'ã‚¢': '--.-', 'ã‚¤': '.-', 'ã‚¦': '..-', 'ã‚¨': '-.---', 'ã‚ª': '.-...',
            'ã‚«': '.-..', 'ã‚­': '-.-.', 'ã‚¯': '...-', 'ã‚±': '-.--', 'ã‚³': '----',
            'ã‚µ': '-.-.-', 'ã‚·': '--.-', 'ã‚¹': '---.-', 'ã‚»': '.---.', 'ã‚½': '---.',
            'ã‚¿': '-', 'ãƒ': '..-.', 'ãƒ„': '.--', 'ãƒ†': '.-.--', 'ãƒˆ': '..-..',
            'ãƒŠ': '.-.', 'ãƒ‹': '-.-.', 'ãƒŒ': '....', 'ãƒ': '--.-', 'ãƒŽ': '..--',
            'ãƒ': '-...', 'ãƒ’': '--..-', 'ãƒ•': '--..', 'ãƒ˜': '.', 'ãƒ›': '-..',
            'ãƒž': '-..-', 'ãƒŸ': '..-.-', 'ãƒ ': '-', 'ãƒ¡': '-...-', 'ãƒ¢': '-..-',
            'ãƒ¤': '.--', 'ãƒ¦': '-..--', 'ãƒ¨': '--',
            'ãƒ©': '...', 'ãƒª': '--.', 'ãƒ«': '-.--', 'ãƒ¬': '---', 'ãƒ­': '.-.-',
            'ãƒ¯': '-.-', 'ãƒ²': '.---', 'ãƒ³': '.-.-.'
        }
    },
    cyrillic: {
        title: "Cyrillic (Ð ÑƒÑÑÐºÐ¸Ð¹)",
        codes: {
            'Ð': '.-', 'Ð‘': '-...', 'Ð’': '.--', 'Ð“': '--.', 'Ð”': '-..',
            'Ð•': '.', 'Ð–': '...-', 'Ð—': '--..', 'Ð˜': '..', 'Ð™': '.---',
            'Ðš': '-.-', 'Ð›': '.-..', 'Ðœ': '--', 'Ð': '-.', 'Ðž': '---',
            'ÐŸ': '.--.', 'Ð ': '.-.', 'Ð¡': '...', 'Ð¢': '-', 'Ð£': '..-',
            'Ð¤': '..-.', 'Ð¥': '....', 'Ð¦': '-.-.', 'Ð§': '---.', 'Ð¨': '----',
            'Ð©': '--.-', 'Ðª': '.--.-.', 'Ð«': '-.--', 'Ð¬': '-..-', 'Ð­': '..-.',
            'Ð®': '..--', 'Ð¯': '.-.-'
        }
    },
    arabic: {
        title: "Arabic (Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©)",
        codes: {
            'Ø§': '.-', 'Ø¨': '-...', 'Øª': '-', 'Ø«': '-.-.', 'Ø¬': '.---',
            'Ø­': '....', 'Ø®': '---', 'Ø¯': '-..', 'Ø°': '--..', 'Ø±': '.-.',
            'Ø²': '---', 'Ø³': '...', 'Ø´': '----', 'Øµ': '-..-', 'Ø¶': '...-',
            'Ø·': '..-', 'Ø¸': '-.--', 'Ø¹': '.-.-', 'Øº': '--.', 'Ù': '..-.',
            'Ù‚': '--.-', 'Ùƒ': '-.-', 'Ù„': '.-..', 'Ù…': '--', 'Ù†': '-.',
            'Ù‡': '.....', 'Ùˆ': '.--', 'ÙŠ': '..'
        }
    },
    punctuation: {
        title: "Punctuation & Special",
        codes: {
            '.': '.-.-.-', ',': '--..--', '?': '..--..', "'": '.----.', 
            '!': '-.-.--', '/': '-..-.', '(': '-.--.', ')': '-.--.-',
            '&': '.-...', ':': '---...', ';': '-.-.-.', '=': '-...-',
            '+': '.-.-.', '-': '-....-', '_': '..--.-', '"': '.-..-.',
            '$': '...-..-', '@': '.--.-', ' ': '/'
        }
    }
};

// Combined morse code mapping for translation
const morseCode = {};
Object.values(morseCodeTables).forEach(table => {
    Object.assign(morseCode, table.codes);
});

// Reverse mapping for decoding
const reverseMorseCode = {};
Object.keys(morseCode).forEach(key => {
    reverseMorseCode[morseCode[key]] = key;
});

// Language detection patterns
const languagePatterns = {
    ko: /[ã„±-ã…Žã…-ã…£ê°€-íž£]/,
    ja: /[ã²ã‚‰ãŒãªã‚«ã‚¿ã‚«ãƒŠä¸€-é¾¯]/,
    zh: /[\u4e00-\u9fff]/,
    ru: /[Ð°-ÑÑ‘]/i,
    ar: /[\u0600-\u06ff]/,
    en: /^[a-zA-Z0-9\s.,!?'"()-]+$/
};

// Current state
let currentLang = 'en';
let isTextToMorse = true;
let audioContext;
let isPlaying = false;
let currentOscillator = null;
let currentToneTimeout = null;

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    init();
});

function init() {
    console.log('Initializing app...');
    detectUserLanguage();
    setupEventListeners();
    updateUI();
    createParticles();
    loadFromURL();
    
    // ì´ˆê¸° ìƒ˜í”Œ í…ìŠ¤íŠ¸
    setTimeout(() => {
        if (!document.getElementById('inputArea').value) {
            document.getElementById('inputArea').value = 'Hello World';
            translateText();
        }
    }, 1000);
}

function detectUserLanguage() {
    const userLang = navigator.language.split('-')[0];
    console.log('Detected browser language:', userLang);
    if (translations[userLang]) {
        currentLang = userLang;
        const langName = getLanguageName(userLang);
        console.log('Setting language to:', langName);
        document.getElementById('currentLang').textContent = langName;
    }
}

function getLanguageName(lang) {
    const names = {
        en: 'ðŸ‡ºðŸ‡¸ English',
        ko: 'ðŸ‡°ðŸ‡· í•œêµ­ì–´',
        ja: 'ðŸ‡¯ðŸ‡µ æ—¥æœ¬èªž',
        zh: 'ðŸ‡¨ðŸ‡³ ä¸­æ–‡',
        es: 'ðŸ‡ªðŸ‡¸ EspaÃ±ol',
        fr: 'ðŸ‡«ðŸ‡· FranÃ§ais',
        de: 'ðŸ‡©ðŸ‡ª Deutsch',
        ru: 'ðŸ‡·ðŸ‡º Ð ÑƒÑÑÐºÐ¸Ð¹',
        ar: 'ðŸ‡¸ðŸ‡¦ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©'
    };
    return names[lang] || 'ðŸ‡ºðŸ‡¸ English';
}

function setupEventListeners() {
    console.log('Setting up event listeners...');
    
    // Language selector - ìˆ˜ì •ëœ ì´ë²¤íŠ¸ í•¸ë“¤ë§
    const languageBtn = document.getElementById('languageBtn');
    const languageDropdown = document.getElementById('languageDropdown');
    
    if (languageBtn && languageDropdown) {
        console.log('Language selector found, setting up events...');
        
        languageBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('Language button clicked');
            
            const isExpanded = languageDropdown.classList.contains('active');
            console.log('Dropdown is currently expanded:', isExpanded);
            
            languageDropdown.classList.toggle('active');
            languageBtn.setAttribute('aria-expanded', !isExpanded);
            
            console.log('Dropdown toggled. Active class:', languageDropdown.classList.contains('active'));
        });

        // ì–¸ì–´ ì˜µì…˜ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll('.language-option').forEach(option => {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const lang = this.dataset.lang;
                const langText = this.textContent.trim();
                
                console.log('Language option clicked:', lang, langText);
                
                currentLang = lang;
                document.getElementById('currentLang').textContent = langText;
                languageDropdown.classList.remove('active');
                languageBtn.setAttribute('aria-expanded', 'false');
                
                updateUI();
            });
            
            option.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });

        // ì™¸ë¶€ í´ë¦­ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', function(e) {
            if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
                languageDropdown.classList.remove('active');
                languageBtn.setAttribute('aria-expanded', 'false');
            }
        });
    } else {
        console.error('Language selector elements not found!');
    }

    // Reference button
    const referenceBtn = document.getElementById('referenceBtn');
    if (referenceBtn) {
        referenceBtn.addEventListener('click', showReferenceModal);
    }

    // Modal close
    const closeModal = document.getElementById('closeModal');
    const referenceModal = document.getElementById('referenceModal');
    
    if (closeModal) {
        closeModal.addEventListener('click', hideReferenceModal);
    }
    
    if (referenceModal) {
        referenceModal.addEventListener('click', function(e) {
            if (e.target === this) {
                hideReferenceModal();
            }
        });
    }

    // Keyboard navigation for modal
    document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('referenceModal');
        if (modal && modal.style.display === 'block' && e.key === 'Escape') {
            hideReferenceModal();
        }
    });

    // Mode switch
    const modeSwitch = document.getElementById('modeSwitch');
    if (modeSwitch) {
        modeSwitch.addEventListener('click', function() {
            console.log('Mode switch clicked');
            isTextToMorse = !isTextToMorse;
            
            // Swap input and output values
            const inputArea = document.getElementById('inputArea');
            const outputArea = document.getElementById('outputArea');
            const tempValue = inputArea.value;
            inputArea.value = outputArea.value;
            outputArea.value = tempValue;
            
            updateUI();
            translateText();
        });
    }

    // Input area
    const inputArea = document.getElementById('inputArea');
    if (inputArea) {
        inputArea.addEventListener('input', function() {
            translateText();
            detectLanguage();
        });
    }

    // Action buttons
    const copyBtn = document.getElementById('copyBtn');
    const clearBtn = document.getElementById('clearBtn');
    const shareBtn = document.getElementById('shareBtn');
    const copyUrlBtn = document.getElementById('copyUrlBtn');
    const playBtn = document.getElementById('playBtn');
    
    if (copyBtn) copyBtn.addEventListener('click', copyOutput);
    if (clearBtn) clearBtn.addEventListener('click', clearAll);
    if (shareBtn) shareBtn.addEventListener('click', shareTranslation);
    if (copyUrlBtn) copyUrlBtn.addEventListener('click', copyShareUrl);
    if (playBtn) playBtn.addEventListener('click', playMorse);

    // Speed slider
    const speedSlider = document.getElementById('speedSlider');
    if (speedSlider) {
        speedSlider.addEventListener('input', function() {
            const speedValue = document.getElementById('speedValue');
            if (speedValue) {
                speedValue.textContent = this.value;
            }
        });
    }
    
    console.log('Event listeners setup complete');
}

function showReferenceModal() {
    console.log('Showing reference modal...');
    const modal = document.getElementById('referenceModal');
    const content = document.getElementById('codebookContent');
    
    if (!modal || !content) {
        console.error('Modal elements not found');
        return;
    }
    
    content.innerHTML = '';
    
    Object.entries(morseCodeTables).forEach(([key, table]) => {
        const section = document.createElement('div');
        section.className = 'codebook-section';
        
        const title = document.createElement('h3');
        title.className = 'codebook-title';
        title.textContent = table.title;
        section.appendChild(title);
        
        const grid = document.createElement('div');
        grid.className = 'codebook-grid';
        
        Object.entries(table.codes).forEach(([char, morse]) => {
            const item = document.createElement('div');
            item.className = 'code-item';
            
            const charSpan = document.createElement('span');
            charSpan.className = 'code-char';
            charSpan.textContent = char;
            
            const morseSpan = document.createElement('span');
            morseSpan.className = 'code-morse';
            morseSpan.textContent = morse;
            
            item.appendChild(charSpan);
            item.appendChild(morseSpan);
            grid.appendChild(item);
        });
        
        section.appendChild(grid);
        content.appendChild(section);
    });
    
    modal.style.display = 'block';
    modal.setAttribute('aria-hidden', 'false');
    document.getElementById('closeModal').focus();
}

function hideReferenceModal() {
    const modal = document.getElementById('referenceModal');
    if (modal) {
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
        document.getElementById('referenceBtn').focus();
    }
}

function updateUI() {
    console.log('Updating UI for language:', currentLang);
    const t = translations[currentLang];
    if (!t) {
        console.error('Translation not found for language:', currentLang);
        return;
    }

    // Update text elements safely
    const elements = {
        'title': t.title,
        'subtitle': t.subtitle,
        'inputLabel': t.inputLabel,
        'outputLabel': t.outputLabel,
        'modeText': isTextToMorse ? t.modeTextToMorse : t.modeMorseToText,
        'playText': t.playText,
        'copyText': t.copyText,
        'clearText': t.clearText,
        'shareText': t.shareText,
        'shareTitle': t.shareTitle,
        'copyUrlText': t.copyUrlText,
        'downloadTitle': t.downloadTitle,
        'downloadDescription': t.downloadDescription,
        'downloadText': t.downloadText,
        'speedLabel': t.speedLabel,
        'referenceText': t.referenceText,
        'modalTitle': t.modalTitle
    };

    Object.entries(elements).forEach(([id, text]) => {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = text;
        } else {
            console.warn(`Element with id '${id}' not found`);
        }
    });

    // Update placeholder
    const inputArea = document.getElementById('inputArea');
    if (inputArea) {
        inputArea.placeholder = isTextToMorse ? t.placeholder : t.morsePlaceholder;
    }

    // Update document properties
    document.documentElement.lang = currentLang;
    document.title = t.title;
    
    console.log('UI update complete');
}

function detectLanguage() {
    const inputArea = document.getElementById('inputArea');
    const detectedLanguage = document.getElementById('detectedLanguage');
    
    if (!inputArea || !detectedLanguage) return;
    
    const text = inputArea.value;
    if (!text.trim()) {
        detectedLanguage.textContent = '';
        return;
    }

    for (const [lang, pattern] of Object.entries(languagePatterns)) {
        if (pattern.test(text)) {
            const t = translations[currentLang];
            if (t) {
                detectedLanguage.textContent = t.detectedLang + getLanguageName(lang);
            }
            return;
        }
    }
}

function translateText() {
    const inputArea = document.getElementById('inputArea');
    const outputArea = document.getElementById('outputArea');
    
    if (!inputArea || !outputArea) return;
    
    const input = inputArea.value;

    if (isTextToMorse) {
        outputArea.value = textToMorse(input);
    } else {
        outputArea.value = morseToText(input);
    }
}

function decomposeKorean(char) {
    const code = char.charCodeAt(0);
    if (code >= 0xAC00 && code <= 0xD7A3) {
        const base = code - 0xAC00;
        const cho = Math.floor(base / 588);
        const jung = Math.floor((base % 588) / 28);
        const jong = base % 28;
        
        const choSeong = ['ã„±','ã„²','ã„´','ã„·','ã„¸','ã„¹','ã…','ã…‚','ã…ƒ','ã……','ã…†','ã…‡','ã…ˆ','ã…‰','ã…Š','ã…‹','ã…Œ','ã…','ã…Ž'];
        const jungSeong = ['ã…','ã…','ã…‘','ã…’','ã…“','ã…”','ã…•','ã…–','ã…—','ã…˜','ã…™','ã…š','ã…›','ã…œ','ã…','ã…ž','ã…Ÿ','ã… ','ã…¡','ã…¢','ã…£'];
        const jongSeong = ['','ã„±','ã„²','ã„³','ã„´','ã„µ','ã„¶','ã„·','ã„¹','ã„º','ã„»','ã„¼','ã„½','ã„¾','ã„¿','ã…€','ã…','ã…‚','ã…„','ã……','ã…†','ã…‡','ã…ˆ','ã…Š','ã…‹','ã…Œ','ã…','ã…Ž'];
        
        let result = '';
        if (choSeong[cho]) result += choSeong[cho];
        if (jungSeong[jung]) result += jungSeong[jung];
        if (jong > 0 && jongSeong[jong]) result += jongSeong[jong];
        
        return result;
    }
    return char;
}

function textToMorse(text) {
    let result = '';
    for (let i = 0; i < text.length; i++) {
        const char = text[i];
        if (char === ' ') {
            result += ' / ';
        } else if (/[ê°€-íž£]/.test(char)) {
            const decomposed = decomposeKorean(char);
            for (const jamo of decomposed) {
                if (morseCode[jamo]) {
                    result += morseCode[jamo] + ' ';
                }
            }
            result += '| '; // Syllable separator
        } else {
            const upperChar = char.toUpperCase();
            if (morseCode[upperChar]) {
                result += morseCode[upperChar] + ' ';
            } else {
                result += char + ' ';
            }
        }
    }
    return result.trim();
}

function morseToText(morse) {
    const words = morse.split(' / ');
    return words.map(word => {
        const syllables = word.split(' | ');
        return syllables.map(syllable => {
            const codes = syllable.trim().split(/\s+/);
            return codes.map(code => {
                return reverseMorseCode[code] || code;
            }).join('');
        }).join('');
    }).join(' ');
}

function copyOutput() {
    const outputArea = document.getElementById('outputArea');
    if (!outputArea) return;
    
    outputArea.select();
    outputArea.setSelectionRange(0, 99999);
    
    try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(outputArea.value).then(() => {
                showNotification('Copied!');
                outputArea.classList.add('success-animation');
                setTimeout(() => {
                    outputArea.classList.remove('success-animation');
                }, 600);
            }).catch(() => {
                // Fallback to execCommand
                if (document.execCommand('copy')) {
                    showNotification('Copied!');
                }
            });
        } else {
            // Fallback for older browsers
            if (document.execCommand('copy')) {
                showNotification('Copied!');
            }
        }
    } catch (err) {
        console.error('Copy failed:', err);
        showNotification('Copy failed');
    }
}

function showNotification(message) {
    const copyBtn = document.getElementById('copyBtn');
    if (!copyBtn) return;
    
    const originalHtml = copyBtn.innerHTML;
    copyBtn.innerHTML = `<i class="fas fa-check" aria-hidden="true"></i> ${message}`;
    setTimeout(() => {
        copyBtn.innerHTML = originalHtml;
    }, 2000);
}

function clearAll() {
    const inputArea = document.getElementById('inputArea');
    const outputArea = document.getElementById('outputArea');
    const detectedLanguage = document.getElementById('detectedLanguage');
    const shareSection = document.getElementById('shareSection');
    
    if (inputArea) inputArea.value = '';
    if (outputArea) outputArea.value = '';
    if (detectedLanguage) detectedLanguage.textContent = '';
    if (shareSection) shareSection.style.display = 'none';
    if (inputArea) inputArea.focus();
}

function shareTranslation() {
    const inputArea = document.getElementById('inputArea');
    const outputArea = document.getElementById('outputArea');
    
    if (!inputArea || !outputArea) return;
    
    const input = inputArea.value;
    const output = outputArea.value;
    
    if (!input.trim() && !output.trim()) {
        alert('Please enter some text to share!');
        return;
    }

    const shareData = {
        input: input,
        output: output,
        mode: isTextToMorse ? 'text' : 'morse',
        lang: currentLang
    };

    try {
        const encodedData = btoa(encodeURIComponent(JSON.stringify(shareData)));
        const shareUrl = `${window.location.origin}${window.location.pathname}?data=${encodedData}`;
        
        const shareUrlInput = document.getElementById('shareUrl');
        const shareSection = document.getElementById('shareSection');
        
        if (shareUrlInput) shareUrlInput.value = shareUrl;
        if (shareSection) shareSection.style.display = 'block';
    } catch (e) {
        alert('Failed to create share URL. Please try again.');
        console.error('Share error:', e);
    }
}

function copyShareUrl() {
    const shareUrl = document.getElementById('shareUrl');
    if (!shareUrl) return;
    
    shareUrl.select();
    shareUrl.setSelectionRange(0, 99999);
    
    try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(shareUrl.value).then(() => {
                showShareNotification('Copied!');
            }).catch(() => {
                if (document.execCommand('copy')) {
                    showShareNotification('Copied!');
                }
            });
        } else {
            if (document.execCommand('copy')) {
                showShareNotification('Copied!');
            }
        }
    } catch (err) {
        console.error('Copy failed:', err);
    }
}

function showShareNotification(message) {
    const copyUrlBtn = document.getElementById('copyUrlBtn');
    if (!copyUrlBtn) return;
    
    const originalHtml = copyUrlBtn.innerHTML;
    copyUrlBtn.innerHTML = `<i class="fas fa-check" aria-hidden="true"></i> ${message}`;
    setTimeout(() => {
        copyUrlBtn.innerHTML = originalHtml;
    }, 2000);
}

function loadFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    const data = urlParams.get('data');
    
    if (data) {
        try {
            const shareData = JSON.parse(decodeURIComponent(atob(data)));
            currentLang = shareData.lang || 'en';
            isTextToMorse = shareData.mode === 'text';
            
            const inputArea = document.getElementById('inputArea');
            const outputArea = document.getElementById('outputArea');
            const currentLangElement = document.getElementById('currentLang');
            
            if (inputArea) inputArea.value = shareData.input || '';
            if (outputArea) outputArea.value = shareData.output || '';
            if (currentLangElement) currentLangElement.textContent = getLanguageName(currentLang);
            
            updateUI();
            detectLanguage();
        } catch (e) {
            console.error('Failed to load shared data:', e);
        }
    }
}

function playMorse() {
    if (isPlaying) {
        stopMorsePlayback();
        return;
    }
    
    const outputArea = document.getElementById('outputArea');
    const inputArea = document.getElementById('inputArea');
    
    if (!outputArea || !inputArea) return;
    
    const morseText = isTextToMorse ? outputArea.value : inputArea.value;
    
    if (!morseText.trim()) {
        alert('Please enter some text to generate Morse code first!');
        return;
    }
    
    isPlaying = true;
    const playBtn = document.getElementById('playBtn');
    const originalHtml = playBtn ? playBtn.innerHTML : '';
    
    if (playBtn) {
        playBtn.innerHTML = '<i class="fas fa-stop" aria-hidden="true"></i> Stop';
    }
    
    playMorseAudio(morseText).then(() => {
        isPlaying = false;
        if (playBtn) playBtn.innerHTML = originalHtml;
    }).catch(() => {
        isPlaying = false;
        if (playBtn) playBtn.innerHTML = originalHtml;
    });
}

function stopMorsePlayback() {
    isPlaying = false;
    
    if (currentToneTimeout) {
        clearTimeout(currentToneTimeout);
        currentToneTimeout = null;
    }
    
    if (currentOscillator) {
        try {
            currentOscillator.stop();
            currentOscillator.disconnect();
        } catch (e) {
            // Oscillator might already be stopped
        }
        currentOscillator = null;
    }
    
    const playBtn = document.getElementById('playBtn');
    const t = translations[currentLang] || translations['en'];
    if (playBtn) {
        playBtn.innerHTML = `<i class="fas fa-play" aria-hidden="true"></i> ${t.playText}`;
    }
}

async function playMorseAudio(morseText) {
    try {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        if (audioContext.state === 'suspended') {
            await audioContext.resume();
        }
        
        const speedSlider = document.getElementById('speedSlider');
        const speed = speedSlider ? parseInt(speedSlider.value) : 5;
        const dotDuration = 1200 / speed;
        const dashDuration = dotDuration * 3;
        const pauseDuration = dotDuration;
        const letterPauseDuration = dotDuration * 3;
        const wordPauseDuration = dotDuration * 7;
        
        const frequency = 600;
        
        for (let i = 0; i < morseText.length && isPlaying; i++) {
            const char = morseText[i];
            
            if (!isPlaying) break;
            
            if (char === '.') {
                await playTone(frequency, dotDuration);
                if (isPlaying) await sleep(pauseDuration);
            } else if (char === '-') {
                await playTone(frequency, dashDuration);
                if (isPlaying) await sleep(pauseDuration);
            } else if (char === ' ') {
                await sleep(letterPauseDuration);
            } else if (char === '/') {
                await sleep(wordPauseDuration);
            }
        }
    } catch (e) {
        console.error('Audio playback error:', e);
        throw e;
    }
}

function playTone(frequency, duration) {
    return new Promise((resolve) => {
        if (!isPlaying) {
            resolve();
            return;
        }
        
        try {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            currentOscillator = oscillator;
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + 0.01);
            gainNode.gain.linearRampToValueAtTime(0.2, audioContext.currentTime + duration / 1000 - 0.01);
            gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + duration / 1000);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + duration / 1000);
            
            oscillator.onended = () => {
                currentOscillator = null;
                resolve();
            };
            
            currentToneTimeout = setTimeout(() => {
                currentOscillator = null;
                resolve();
            }, duration);
        } catch (e) {
            console.error('Tone playback error:', e);
            currentOscillator = null;
            resolve();
        }
    });
}

function sleep(ms) {
    return new Promise(resolve => {
        if (!isPlaying) {
            resolve();
            return;
        }
        currentToneTimeout = setTimeout(resolve, ms);
    });
}

// Create floating particles
function createParticles() {
    const particlesContainer = document.getElementById('particles');
    if (!particlesContainer) return;
    
    const particleCount = 40;

    for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.animationDelay = Math.random() * 15 + 's';
        particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
        particlesContainer.appendChild(particle);
    }
    
    console.log('Particles created');
}
